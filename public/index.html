<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT-assisted Nurse Educator</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        #answerDiv {
            background-color: #f8f9fa;
            height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse; /* Latest messages at the bottom */
        }

        .chat-message {
            padding: 10px;
            margin: 5px;
            border-radius: 10px;
        }

        .user-message {
            background-color: #dcf8c6;
            align-self: flex-end;
        }

        .bot-message {
            background-color: #e5e5ea;
            align-self: flex-start;
        }

        #questionInput {
            margin-bottom: 0; /* Remove margin to stack input with button */
        }

        #askButton {
            width: 100%;
        }
    </style>
</head>
<body>



    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">ChatGPT-assisted Nurse Educator</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="./cases/chickenpox.html">Case Summary</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="container mt-5">
        <div class="search-bar mb-3">
            <p>You are a public health nurse investigating a case of chickenpox. Please ask the chatbot questions to learn about the case. When you are finished asking questions, type END to receive an evaluation based on the RIME Framework. A Case Summary describing the case can be found above once you are finished with your investigation.</p>
            <input type="text" id="questionInput" class="form-control" placeholder="Ask a question...">
            <button id="askButton" class="btn btn-primary mt-3">Ask</button>
        </div>
        <div id="answerDiv" class="border p-3 bg-light"></div>
        <button id="copyButton" class="btn btn-secondary mt-3">Copy Response</button>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light text-center p-3 mt-5">
        <p><a href="./" class="text-light">ChatGPT-assisted Nurse Educator</a>.</p>
    </footer>

    <!-- Bootstrap and jQuery Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="/js/marked.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- Custom Script  <script src="js/script.js"></script> -->
    <script>

        $(document).ready(function () {
            // Function to add a message to the chat display
            function addChatMessage(content, isUser = false) {
                const divClass = isUser ? 'chat-message user-message' : 'chat-message bot-message';

                // Use marked to convert Markdown content to HTML
                const messageHtml = content;

                // Create a div and set its HTML to the converted content
                const messageDiv = $('<div>').addClass(divClass).html(messageHtml);

                $('#answerDiv').prepend(messageDiv); // Prepend to keep the latest message at the bottom
            }

            // Function to send the question to the server and handle the response
            function sendQuestion() {
                const question = $('#questionInput').val();
                if (question.trim() === '') return;

                addChatMessage(question, true); // Add user's message to the chat

                // Make an AJAX request to your server here
                // Example using jQuery AJAX:
                $.ajax({
                    url: '/api/query',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ prompt: question }),
                    success: function (response) {
                        // Add the bot's response to the chat
                        addChatMessage(response.message);
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });

                // Clear the input field after sending
                $('#questionInput').val('');
            }

            // Event listener for the 'Ask' button
            $('#askButton').click(sendQuestion);

            // Event listener for pressing Enter to submit
            $('#questionInput').keypress(function (event) {
                if (event.keyCode === 13) { // 13 is the Enter key
                    sendQuestion();
                }
            });

            // Event listener for the 'Copy Response' button
            $('#copyButton').click(function () {
                // Select the content of the answer div
                const answerDivText = $('#answerDiv').text();
                if (!answerDivText) return;

                // Copy the text to the clipboard
                navigator.clipboard.writeText(answerDivText).then(function () {
                    alert('Response copied to clipboard');
                }).catch(function (error) {
                    alert('Error copying text: ', error);
                });
            });
        });


    </script>
</body>
</html>
